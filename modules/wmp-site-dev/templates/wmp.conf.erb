ExtendedStatus On

<VirtualHost *:80>
    ServerAdmin sysadmin@cambridge.org
    DocumentRoot /data/httpd/wmp
    ServerName www.cambridge.org
    ServerAlias wmpdev.cambridge.org
    ErrorLog /data/logs/httpd/wmp/wmp-error_log
    CustomLog /data/logs/httpd/wmp/wmp-access_log common
    AccessFileName WeDontUseHtaccess

    <Location /server-status>
        SetHandler server-status
        Order Deny,Allow
        Deny from all
        Allow from utility.internal
    </Location>

    <Directory "/data/httpd/wmp">
	SetEnv WMP_MARKETING_SITE_BASE_URL http://<%= domain %>
	SetEnv WMP_MARKETING_SITE_BASE_URL_SSL https://<%= domain %>
        SetEnv WMP_MARKETING_SITE_DIR_REL 
        SetEnv WMP_MARKETING_DB_SERVER <%= mysql %>
        SetEnv WMP_MARKETING_DB_USERNAME concrete_usr2012
        SetEnv WMP_MARKETING_DB_PASSWORD k3ey!Bo0rd&
        SetEnv WMP_MARKETING_DB_DATABASE cms_concrete_db2012
        SetEnv WMP_MARKETING_SITE_CACHE apc
        SetEnv WMP_MARKETING_SITE_EVENTS true
        SetEnv WMP_USE_GLOBAL_NAV_LOCAL_LINKS Y
	SetEnv IS_ADMIN_NODE <%= (admin_node ? "Y" : "N") %>
	SetEnv ADMIN_NODE_URL http://admin.aws.cambridgeuniversitypress.com/dashboard/
	SetEnv WMP_SITE_ADMIN_NAME 'Cambridge University Press'
	SetEnv WMP_SITE_ADMIN_EMAIL concrete5@cambridge.org
	SetEnv WMP_API_USERNAME marketing
	SetEnv WMP_API_PASSWORD 4RagEsw+g!spU*u
	SetEnv WMP_VYRE_BASE_URL http://<%= domain %>
	SetEnv WMP_IIS_BASE_URL http://<%= domain %>
	SetEnv WMP_SALESFORCE_BASE_URL http://cambridge.prelive.cs13.force.comÂ§
        SetEnv WMP_SOLR_SERVER localhost
        SetEnv WMP_SOLR_PORT 8080
        SetEnv WMP_SOLR_MASTER <%= nosql_master %>
        SetEnv WMP_SOLR_MASTER_PORT 8080
        SetEnv WMP_SOLR_INDEX wmp
        SetEnv WMP_SOLR_INDEX_PATH /wmp/
        SetEnv WMP_MONGO_MASTER <%= nosql_master %> 
        SetEnv WMP_MONGO_MASTER_PORT 27017
        SetEnv WMP_MONGO_SERVER localhost
        SetEnv WMP_MONGO_PORT 27017
        SetEnv WMP_MONGO_REPLICA_SET wmp
        SetEnv WMP_API_ROOT_URL http://api.cambridge.org/

        Options Indexes FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteRule ^((\d{10})|(\d{13})|(\d{9}([A-Z]|[a-z]))|(\d{12}([A-Z]|[a-z])))$ tools/packages/cambridge_data/isbnFilter?isbn=$1 [L]
            RewriteCond %{REQUEST_URI} !^/mod_pagespeed_[a-z_]+$
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME}/index.html !-f
            RewriteCond %{REQUEST_FILENAME}/index.php !-f
            RewriteRule . index.php [L]
        </IfModule>
    </Directory>

    <Directory /data/httpd/wmp/packages/mainio_minco/libraries/3rdparty/minify-2.1.5/min>
        <IfModule mod_rewrite.c>
            RewriteEngine on
            # You may need RewriteBase on some servers
            #RewriteBase /min
            # rewrite URLs like "/min/f=..." to "/min/?f=..."
            RewriteRule ^([bfg]=.*)  index.php?$1 [L,NE]
        </IfModule>
        <IfModule mod_env.c>
            # In case AddOutputFilterByType has been added
            SetEnv no-gzip
        </IfModule>
    </Directory>

    <Directory /data/httpd/wmp/v2>
        AuthName Title
        AuthUserFile /data/httpd/nonexistant
        Require valid-user 
    </Directory>

    <Directory /data/httpd/wmp/concrete/libraries/3rdparty/securimage/database>
        Order Deny,Allow
        Deny from all
    </Directory>

    <Directory /data/httpd/wmp/files/backups>
        Order Deny,Allow
        Deny from all
    </Directory>

    # IE7 compatibility fix
    <IfModule mod_headers.c>
      Header set X-UA-Compatible "IE=edge,chrome=1"
      <FilesMatch "\.(appcache|crx|css|eot|gif|htc|ico|jpe?g|js|m4a|m4v|manifest|mp4|oex|oga|ogg|ogv|otf|pdf|png|safariextz|svg|svgz|ttf|vcf|webapp|webm|webp|woff|xml|xpi)$">
        Header unset X-UA-Compatible
      </FilesMatch>
    </IfModule>


    # Additional mime types
    AddType video/mp4 .m4v
</VirtualHost>


##
